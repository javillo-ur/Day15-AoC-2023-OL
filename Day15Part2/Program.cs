Console.WriteLine(new List<string>(){File.ReadAllLines("input.txt").Aggregate("", (previous, current) => previous+current)}.Select(j => j.Split(",")).Select(j => j.Select(w => w.Contains('=')? new Tuple<string,int,int>(w.Split("=")[0], w.Split("=")[0].Aggregate(0, (previous, current) => (previous + current)*17%256),int.Parse(w.Split("=")[1])) : new Tuple<string,int,int>(w.Split("-")[0], w.Split("-")[0].Aggregate(0, (previous, current) => (previous + current)*17%256),-1))).Select(j => j.Aggregate(new Tuple<System.Collections.Concurrent.ConcurrentDictionary<int,List<(string,int)>>,bool>(new(Enumerable.Range(0, 256).Aggregate(new List<(int, List<(string,int)>)>(), (previous,current) => [..previous, (current, new())]).ToDictionary(t => t.Item1, t => t.Item2)),true), (previous, current) => current.Item3 == -1 ? new(previous.Item1, previous.Item1[current.Item2].Remove(previous.Item1[current.Item2].FirstOrDefault(r => r.Item1 == current.Item1))) : new(previous.Item1, previous.Item1.TryGetValue(current.Item2, out var list) && previous.Item1.TryRemove(new(current.Item2, list)) && previous.Item1.TryAdd(current.Item2, list.Any(t => t.Item1 == current.Item1)? list.Select<(string,int), (string,int)>(t => t.Item1 != current.Item1?t : (current.Item1, current.Item3)).ToList() : [..list, (current.Item1, current.Item3)])))).Select(j => j.Item1.Keys.Sum(i => (i+1) * j.Item1[i].Select((t, i) => new Tuple<int,int>(t.Item2, i)).Sum(t => t.Item1 * (1+t.Item2)))).First());